<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>车票订单--已完成订单</title>
    <link href="{{url_for('static', filename='admin-new/css/style.css')}}" rel="stylesheet" type="text/css" />
    <link href="{{url_for('static', filename='admin-new/css/select.css')}}" rel="stylesheet" type="text/css" />
    <script language="JavaScript" src="{{url_for('static', filename='admin-new/js/jquery.js')}}"></script>
    <script type="text/javascript" src="{{url_for('static', filename='admin-new/js/select-ui.min.js')}}"></script>
    <script type="text/javascript" src="{{url_for('static',filename='admin-new/js/datepicker/WdatePicker.js')}}"></script>
    <script language="javascript">
        $(function (){
			//全选
			$("#checkall").checkall({ chname: "test[]", callback: function (e) { } });		
			$(".select3").uedSelect({
				width : 120
			});
        })
    </script>
</head>
<body>
    <div class="place">
        <span>位置：</span>
         <ul class="placeul">
            <li><a href="#">车票订单</a></li>
            <li><a href="#">所有订单</a></li>
        </ul>
    </div>

   <form id="search-form" class="" action="{{url_for('admin.all_order')}}" method="get" enctype='multipart/form-data'>
   <!--查询条件-->
    <div class="formbody">
         <div class="itab">
            <ul>
               <li><a href="javascript:search(1,'');" {% if not condition.status %}class="selected" {% endif %}>全部订单</a></li>
                <li><a href="javascript:search(1,'4');" {% if condition.status=='4' %}class="selected" {% endif %}>等待下单</a></li>
                <li><a href="javascript:search(1,'5');" {% if condition.status=='5' %}class="selected" {% endif %}>下单失败</a></li>
                <li><a href="javascript:search(1,'3');" {% if condition.status=='3' %}class="selected" {% endif %}>等待出票</a></li>
                <li><a href="javascript:search(1,'14');" {% if condition.status=='14' %}class="selected" {% endif %}>出票成功</a></li>
                <li><a href="javascript:search(1,'12');" {% if condition.status=='12' %}class="selected" {% endif %}>正在出票</a></li>
                <li><a href="javascript:search(1,'12');" {% if condition.status=='12' %}class="selected" {% endif %}>正在出票</a></li>
                <li><a href="javascript:search(1,'13');" {% if condition.status=='13' %}class="selected" {% endif %}>出票失败</a></li>
                <li><a href="javascript:search(1,'6');" {% if condition.status=='6' %}class="selected" {% endif %}>源站已退款</a></li>
            </ul>
          <input id="id-status" type="hidden" name="status" value="{{condition.status}}" />
          <input id="id-page" type="hidden" name="page" value="{{page.page}}" />
        </div>
   <div class="tabson">
    <ul class="seachform">
    
    <li>
    <div class="vocation">
    <select id="id-source" name="source" class="select3">
    <option value="">来自代购网站</option> 
    {% for i,v in source_info.items() %}
    <option value="{{i}}" {%if condition.source==i %} selected {% endif %}>{{v["name"]}}</option>
    {% endfor %}
    </select>
    </div>
    </li>
    
    <li>
    <div class="vocation">
      <div class='src_acc_blank'>
        <select class="select3" name="">
          <option value="" >第三方账户</option>
      </select>
      </div>
    
    {% for i,v in source_info.items() %}
    <div class='src_acc' id="id-{{i}}">
      <select class="select3" name="">
        <option value="" >第三方账户</option>
        {% for u,t in v["accounts"].items() %}
          <option value="{{u}}" {%if condition.source_account==u %} selected {%endif%}>{{u}}</option>
        {% endfor %}
      </select>
    </div>
    {% endfor %}
    </div>
    </li>
    
    <li><label>起时日期</label>
       <div class="input-date">
         <input type="text" datatype="/^\s*$|^\d{4}\-\d{1,2}\-\d{1,2}$/" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd'})" class="input" id="txtCreateTime" value="{{str_date }}" name="str_date">
                        <i>日期</i>
        </div>
         - 
        <div class="input-date">
          <input type="text" datatype="/^\s*$|^\d{4}\-\d{1,2}\-\d{1,2}$/" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd'})" class="input" id="txtCreateTime" value="{{end_date}}" name="end_date">
                        <i>日期</i>
        </div>
    </li>
    
    <li><label>&nbsp;</label><input name="" type="submit" class="b_btn" value="查询"/></li>
    
    </ul>

   </div>
   </form>
   
   <div>
    <table class="tablelist">
      <caption>
       <div class="toolbar">
       </div>
        <div class="orderinfo">已处理订单：
          <label id="order_num_tip">{{stat.dealed_total}}个</label>
          已出票数量：<label id="ticket_num_tip">{{stat.issued_total}} 张</label>
          总金额：<label id="order_price_tip">{{stat.money_total}}</label>
          </div>
        </caption>
    	<thead>
    	<tr>
        <th><input type="checkbox"  name="test[]" class="chkID" value="1" id="checkall"/></th>
        <th>12308订单号</th>
        <th>代购订单号</th>
        <th>下单人（联系电话）</th>
        <th>下单/出发时间<i class="sort"><img src="{{url_for('static', filename='admin-new/images/px.gif')}}" /></i></th>
        <th>车次号/行程</th>
        <th>来自源网站</th>
        <th>订票数</th>
        <th>订单金额（元）</th>
        <th>订单状态</th>
        <th>操作</th>
        </tr>
        </thead>
        <tbody>
        {% for d in page["items"] %}
        <tr>
         <td><input type="checkbox"  name="test[]" class="chkID" value="6"/></td>
         <td>{{d.out_order_no}}</td>
         <td>{{d.order_no}}</td>
         <td>{{d.contact_info["name"]}}<br />{{d.contact_info["telephone"]}}</td>
         <td>{{d.create_date_time|format_datetime}}<br>{{d.drv_datetime|format_datetime}}</td>
         <td>{{d.bus_num}}<br>{{d.starting_name.split(';')[0]}} ({{ d.starting_name.split(';')[1]}}) - {{d.destination_name.split(';')[0] or d.destination_name.split(';')[1]}}</td>
         <td>{{source_info[d.crawl_source]["name"]}}<br></td>
         <td>{{d.riders|count}}张</td>
         <td class="m">￥{{d.order_price}}</td>
         <td class="color4">{{status_msg[d.status]}}</td>
         <td><a href="/orders/{{d.order_no}}" class="tablelink">查看</a></td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    </div>
    <!--翻页-->
        <div class="pagin">
    	<div class="message">共<i class="blue">{{page.total}}</i>条记录，当前显示第&nbsp;<i class="blue">{{page.page}}&nbsp;</i>页</div>
        <ul class="paginList">
        <li class="paginItem"><a href="javascript:;"><span class="pagepre"></span></a></li>
        {% if page.page<6 %}
            {% for i in range(1, page.page+1)%}
            <li class="paginItem {%if i==page.page %} current {% endif %}"><a href="javascript:search({{i}}, '{{condition.status}}');">{{i}}</a></li>
            {% endfor %}
            {% for i in range(1, 8-page.page) %}
              {% if page.pageNum>=i+page.page %}
              <li class="paginItem"><a href="javascript:search({{page.page+i}}, '{{condition.status}}');">{{page.page+i}}</a></li>
              {% endif %}
            {% endfor %}
            {% if page.page>7 %}
            <li class="paginItem more"><a href="javascript:;">...</a></li>
            {% endif %}
            <li class="paginItem"><a href="javascript:;"><span class="pagenxt"></span></a></li>
        {% else %}
            {% for i in range(1,3)%}
            <li class="paginItem"><a href="javascript:search({{i}}, '{{condition.status}}');">{{i}}</a></li>
            {% endfor %}
            <li class="paginItem more"><a href="javascript:;">...</a></li>
            {% for i in range(page.page-2, page.page+3)%}
              {% if page.pageNum>=i %}
              <li class="paginItem {%if i==page.page %} current {% endif %}"><a href="javascript:search({{i}}, '{{condition.status}}');">{{i}}</a></li>
              {% endif %}
            {% endfor %}
            {% if page.pageNum>=page.page+3 %}
              <li class="paginItem"><a href="javascript:;"><span class="pagenxt"></span></a></li>
            {% endif %}
        {% endif %}
        </ul>
    </div>
    </div>
</body>
<script type="text/javascript">
function search(page, stus){
    $("#id-page").val(page);
    $("#id-status").val(stus);
    $("#search-form").submit();
};

$(document).ready(function(){
  $(".src_acc").hide();
  $("#id-source").change(function(){
    $(".src_acc_blank").hide();
    $(".src_acc").hide();
    $("#id-"+$(this).val()+" select").attr("name", "source_account");
    $("#id-"+$(this).val()).show();
  });

  {%if condition.source %}
    $(".src_acc_blank").hide();
    $("#id-{{condition.source}}"+" select").attr("name", "source_account");
    $("#id-{{condition.source}}").show();
  {% endif %}
});
</script>
</html>
